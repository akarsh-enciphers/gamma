<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A vulnerable web application developed by Enciphers">
  <meta name="generator" content="Hugo 0.78.2" />

  <title>Solution of the Challenges &middot;  Threads</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://akarsh-enciphers.github.io/gamma/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://akarsh-enciphers.github.io/gamma/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://akarsh-enciphers.github.io/gamma/css/blackburn.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://akarsh-enciphers.github.io/gamma/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://akarsh-enciphers.github.io/gamma/">Threads</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://akarsh-enciphers.github.io/gamma/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://akarsh-enciphers.github.io/gamma/about/"><i class='fa fa-list fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://akarsh-enciphers.github.io/gamma/post/"><i class='fa fa-list fa-fw'></i>Setup</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://akarsh-enciphers.github.io/gamma/contact/"><i class='fa fa-list fa-fw'></i>Challenges</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://akarsh-enciphers.github.io/gamma/solution/"><i class='fa fa-list fa-fw'></i>Solutions</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://akarsh-enciphers.github.io/gamma/new/"><i class='fa fa-list fa-fw'></i>Upcoming Features</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/https://github.com/enciphers/Threads" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2020. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Solution of the Challenges</h1>
  <h2>A vulnerable web application developed by Enciphers</h2>
</div>
<div class="content">
  <p>In this section we will talk about the  solution to all the vulnerabilities present on the Threads application:</p>
<h2 id="low-severity-challenges">Low severity challenges</h2>
<h3 id="self-xss">Self-XSS</h3>
<ol>
<li>The self-xss is present in the name field of the profile section.So go to your profile first:
<img src="./images/lab.png" alt="alt text"></li>
<li>In the name field  enter a XSS payload .Like:</li>
</ol>
<pre><code>&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</code></pre><ol start="3">
<li>Click on update to update new credentials. After this you will see that the entered XSS payload getting  executed on your browser and it will keep getting executed whenever you will visit you profile section through the icon given on home page.</li>
</ol>
<h3 id="hidden-directories">Hidden Directories</h3>
<ol>
<li>We can use <a href="https://github.com/maurosoria/dirsearch">Dirsearch tool</a>  to perform directory brute forcing on application to find the hidden end points of the application.</li>
<li>You can install this tool by clicking on the dirsearch tool on the above point which will redirect you to the github page of that tool. Then  use this  command in your terminal</li>
</ol>
<pre><code>python3 dirsearch.py -u &lt;URL&gt; -e &lt;EXTENSIONS&gt;
</code></pre><p>Example :</p>
<pre><code>python3 dirsearch.py -u http://localhost:3000 -e html,php
</code></pre><ol start="3">
<li>The http status code 200  is shown  on the directories like  <em>/home , /management , /users/login</em>.</li>
<li>These can be accessed by using the endpoint after the domain name in the URL in your browser.Like <strong>http://localhost:3000/management</strong>.</li>
<li>In http://localhost:3000/management a  page opens up where an admin user can only login.The hard-coded mail for the admin account is <strong><a href="mailto:test@test.com">test@test.com</a></strong>. You have to check whether an account with this mail to login as admin exist in the application or not.</li>
</ol>
<h3 id="cross-site-request-forgerycsrf">Cross-site Request Forgery(CSRF)</h3>
<ol>
<li>So Threads application is CSRF vulnerable so we can change many things like password,name etc of a victim account just by sending him a malicious html file performing some actions  and if he opens it  then there will be changes in his account without him knowing about it.</li>
<li>Like here we can take an example of changing a user&rsquo;s password. So what we will be going to do as an attacker is to  create a html file which will have an action for changing password for that user. So when the victim will open up that html file his password will get changed.</li>
<li>First just log in as a user. I have logged in as user3 whose password is currently “user”.</li>
<li>Now as we have logged in as this user(user3) let’s try  changing the password through user account only on threads app. So basically like I am user3 right now and I want to change my password to “user@123”. So I will just update it in my profile section. If I check this request going out of my browser for changing password I get to know that for updating the password the application is using the  <strong>POST</strong> request.</li>
<li>So currently my user3 has the password ‘user@123’.</li>
<li>As you can see in your outgoing request  for  changing the password the request going out is the  ‘POST’ request. Also it was using <strong>password</strong> and <strong>confirm_password</strong> as the hidden  parameters which we knew  while updating the password from the  request going out of our browser.</li>
<li>So as an attacker we know that the http request which will be sent through the browser is a ‘POST’  request to make changes in  the profile section. So now what we will be going to do is make an html document which will perform the action of changing the password when it will be executed.</li>
<li>So the html document for changing the password should contain fields like:</li>
</ol>
<pre><code>&lt;html&gt;

&lt;body onload='document.csrf.submit()'&gt;

&lt;form action='http://localhost:3000/users/update/5fa16bd0dd4e0066a3bed613' name='csrf' method='POST'&gt;

&lt;input type='hidden' name='password' value='1'&gt;

&lt;input type='hidden' name='confirm_password' value='1'&gt;

&lt;/form&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre><ol start="9">
<li>Here in this html document the body tag will load and submit this document, the form tag is performing the action on the profile of the user whose UID is mentioned and the action which which is to be performed is of changing the password value mentioned in the hidden parameters(password,confirm_password).</li>
<li>So as you can see in this html document we have used the form tag which will be  performing the action on ‘user3’ profile and the action which it will be performing is of changing the password of ‘user3’ to ‘1’.  Save the html document with .html extension.</li>
<li>So what an attacker need to do  is that he has to send this html document via link or some way to the victims browser and as soon as the victims click on it this html document will get executed by changing the password of the victims account.</li>
<li>So when he will open this file you will see the message of the account updated.</li>
<li>So now the new password for user3 is ‘1’ and the user3 does not even know about this, all he did was that he opened that file which can be sent via link or any other way to the victims system.</li>
<li>Keep in mind that in the real world application you have to know hidden parameters which are getting used for changing the password and also the url or endpoint of the user account or the UID given to the user.</li>
<li>Here the html document you created is in your localhost so just open that document via any browser you wer workink on and you will see the notification of account getting updated and the password for your user will be changed.</li>
<li>Keep in mind that the url provide in form action of the html document the UID present there is for my user so change it to the UID provided for your user to see changes.</li>
</ol>
<h2 id="medium-level-severity">Medium level Severity</h2>
<h3 id="mongodb-injection">MongoDB Injection</h3>
<ol>
<li>The mongoDB injection is present inside the <strong>search bar</strong> of the threads application.</li>
<li>When you write any username on the search bar and search for it then it passes the query searching for the user with the exact same name in its database. If there is the user present with the exact same name then it will show details about it on your screen.</li>
</ol>
<h2 id="high-level-severity">High level Severity</h2>
<h3 id="idor">IDOR</h3>
<ol>
<li>The IDOR is present in the  deletion of a post or on the comment of that post.</li>
<li>As you can see that there is a feature present in the Threads application where a user can delete only and only his post that he has created and also he can delete only his comment that he has made on a post. So a user cannot delete any other users post but as mentioned that there is an IDOR vulnerability in the application so it can be done using the BurpSuite.</li>
<li>This IDOR vulnerability is present in the section of deletion of a post or comment which means we can delete any other users post or comment though it’s not possible with the feature  inside the application but we can do it with the help of BurpSuite.So open your BurpSuite and connect it with the  browser you are working on.</li>
<li>To solve  this vulnerability  we need two accounts. So let’s login with our first account (let&rsquo;s say first account name is “User1”) and create a post with our first account.</li>
<li>As you can see the post from user1 account has been created. So if you check the sitemap tab present inside the target tab in your BurpSuite will see that all the http requests have been captured. Go to http://localhost:3000 section you can see there that the post you created its UUID has been made which is inside the create option in the post folder and also an UUID is created to delete that post which you will find in the delete folder.</li>
<li>Actually what BurpSuite does is it list all the folder and directories of that website which is being targetted inside the sitemap tab which is present inside the target tab.</li>
<li>Now let’s login with another account(let&rsquo;s say  second account name is ‘User2’) and create a post.</li>
<li>For the post created by user2 a  create and delete UUID has been created inside the sitemap tab present inside the target tab in the BurpSuite. So as you can see in the delete folder  there are two UUID. The first one is for the post created from user1 account and the second one is for the post created from user2 account.</li>
<li>Now as you know that user2  can delete only his post which he created according to the feature of the application but as we know IDOR is present so we can delete other users post too. So click on the delete option for the post created by user2 and capture this delete request in your proxy tab.</li>
<li>As you can see in the outgoing request the UUID of that post is present which we are going to delete and this UUID was created for the post which user2 created. So before forwarding the request change the UUID to some other  UUID which is given to the post created by some other user. So we will change user2 UUID with user1 UUID and then we will forward this request.</li>
<li>After forwarding  this request  check that the post made by user1 is  successfully deleted while logging into user2 account.</li>
<li>So basically user2 made his deletion request as a bait so instead of his post UUID he can replace it with user1 UUID and send that deletion request to delete another user post from his account.</li>
</ol>
<h3 id="ssrf">SSRF</h3>
<ol>
<li>So there is a simple ssrf which is present in the profile section of this application under the url field which is used for uploading an image via url.</li>
<li>So the /etc/passwd file is leaking which we have to find out.The /etc/passwd file on Unix systems contains password information. An attacker who has accessed the etc/passwd file may attempt a brute force attack of all passwords on the system. An attacker may attempt to gain access to the etc/passwd file through HTTP, FTP, or SMB. Typically this is done through one of the CGI scripts installed on the server, so this event may be seen in conjunction with other events of that type.</li>
<li>So go to your profile section the last field the URL on is used to upload an image via URL.</li>
<li>So now let’s use the file protocol on this field and try to get /etc/passwd file from the server. Use <strong>file:///etc/passwd</strong> on the url field to fetch the file from the server.</li>
<li>Update this and open your profile section again and you will see that  in the image section there is no image because obviously that was not an url for uploading an image.</li>
<li>Now save that image by doing right click on it and then clicking on view image button.</li>
<li>Open your terminal and go to where you have saved that image and open that image file using the nano command “nano [file name]”.</li>
<li>As you can see now you have access to the /etc/passwd file which you have accessed using file protocol.</li>
</ol>
<h3 id="stored-xss">Stored-XSS</h3>
<ol>
<li>This XSS is present inside the profile section inside the website field. It is a stored XSS which is only executable when seen in an unauthenticated state. So first let’s go to the  profile section and put a simple javascript XSS payload inside the website field. XSS payload=</li>
</ol>
<pre><code>&gt;&lt;script&gt;alert(“Hacker”)&lt;/script&gt;
</code></pre><ol start="2">
<li>Update the profile and now copy the url for this page shown in your browser.</li>
<li>After copying open a new private window and paste this url in your browser and enter.</li>
<li>As you can see the XSS has been executed when we visited from an unauthenticated state.</li>
</ol>
<h2 id="critical-level-severity">Critical level Severity</h2>
<h3 id="jwt-authentication">JWT Authentication</h3>
<ol>
<li>So basically first you have to check whether there is an  user account with email <strong><a href="mailto:test@test.com">test@test.com</a></strong> with password <strong>123</strong> is present  because that is the hardcoded email.So first make sure that an account exists with the above email id and then try to forge the token.</li>
<li>There is a /management page which has an authentication system which works via JWT API .</li>
<li>Visit this management page in the application  and sign in as <code>test@test.com</code>. Capture this sign-in request  going out of your browser with the  BurpSuite proxy.</li>
<li>Open the proxy tab in your BurpSuite to check the outgoing request.Copy this request and send it to the repeater.</li>
<li>In the repeater tab send that request to check out the response for that request. As you can see in the response section you have got the token written with green ink. Now copy that token and send it to <a href="https://jwt.io/">jwt.io</a>.</li>
<li>The JWT token is divided in three parts: algo,payload,signature.</li>
<li>So basically we have to find out the secret key used in this token in the signature section because the new token which we will make it for the unauthorized user to access the admin section should  have the same signature .</li>
<li>The application matches the signature with the signature present on the server side to give access to our unauthorized user. Mainly  we have to fool the application showing them that we are an admin user  and we are entering as an admin.</li>
<li>To crack the secret key inside this token you can use this tool <a href="https://github.com/ticarpi/jwt_tool/blob/master/jwt_tool.py">JWT secret key cracking tool</a> . Click on the link provided and install the tool  in your system.</li>
<li>To do brute forcing we need a wordlist file (where many passwords are given) which we can use for getting the secret key. So for this application the wordlist file is given on Enciphers github visit this link provided  and save this file<a href="https://github.com/enciphers/WebHacking-Training-Resources/blob/master/jwt-wordlist">Password file</a>. Save this file with any  name in your system  like <code>passwd.txt</code>.</li>
<li>Now   use this tool to find the secret key. Go to your terminal and open wherever you installed that tool. Syntax of the  command is:</li>
</ol>
<pre><code>python3 jwt_tool.py  [jwt token you got on your BurpSuite] -C -d  [the wordlist file you saved]
</code></pre><ol start="12">
<li>The command is  example(according to the jwt token I got and the wordlist file I saved with the name of passwd.txt ):</li>
</ol>
<pre><code>python3 jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFiaGluYXZAZW5jaXBoZXJzLmNvbSIsImlhdCI6MTYwNDY1OTIwNiwiZXhwIjoxNjA0NjY5MjA2fQ.2CrCcllttd02ktDrnUlUFiWj-oHxd4HXvf20yiYAo1M -C -d passwd.txt
</code></pre><ol start="13">
<li>As you can see the secret key for the token is <strong>thr3@ds@000</strong>. Use this key in this website <a href="https://jwt.io/">JWT.io</a>  to encode a new token for your account(unauthorized user). Then use that token while logging in on the management page with your account. You will get the access with your account in the management section.</li>
</ol>
<p>Happy learning,Happy hacking!</p>

</div>

</div>
</div>
<script src="https://akarsh-enciphers.github.io/gamma/js/ui.js"></script>
<script src="https://akarsh-enciphers.github.io/gamma/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'Your Google Analytics tracking ID', 'auto');
    ga('send', 'pageview');
  }
</script>







</body>
</html>

